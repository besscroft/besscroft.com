---
title: "æˆ‘å’ŒDockerçš„æ•…äº‹"
date: 2021-04-18T15:14:24+08:00
tags: ["Docker","Linux"]
categories: ["æŠ€æœ¯"]
---

![](/images/articles/2021/Dockerç¬”è®°/docker.png)

### åˆæ¬¡æ¥è§¦

æƒ³èµ·ç¬¬ä¸€æ¬¡ç”¨Dockerçš„åŸå› ï¼Œå½“æ—¶è¿˜åœ¨è¯»ä¹¦ï¼Œæ‰€ä»¥æ‰‹é‡Œçš„æµ·å¤–æœåŠ¡å™¨å¹¶ä¸å¤šã€‚å½“æ—¶ä¸ºäº†æ–¹ä¾¿è‡ªå·±ç§‘å­¦ä¸Šç½‘æŸ¥å­¦ä¹ èµ„æ–™ï¼Œç”±äºä¼—æ‰€å‘¨çŸ¥çš„åŸå› ï¼Œå¿…é¡»å¾—ç”¨æ‰‹é‡Œæ•°é‡ä¸å¤šçš„æœåŠ¡å™¨æ¥ä»£ç†äº†ã€‚ä½†æ˜¯æ‰‹é‡Œåˆæœ‰å…¶å®ƒæœåŠ¡éœ€è¦è·‘ï¼Œé‚£ä¹ˆä¸€å°æœåŠ¡å™¨è¿è¡ŒåŒ…æ‹¬ç§‘å­¦ä¸Šç½‘åœ¨å†…çš„ä¼—å¤šæœåŠ¡ä¹Ÿå°±å¸ç©ºè§æƒ¯äº†ã€‚ç„¶è€Œä»¤äººå¤´ç—›çš„å°±åœ¨è¿™é‡Œï¼Œå› ä¸ºä¸åŒæœåŠ¡çš„ç¯å¢ƒé—®é¢˜ï¼Œå¯¼è‡´æŸäº›æœåŠ¡é€šå¸¸åªèƒ½æ­£å¸¸è¿è¡Œå…¶ä¸­ä¸€ä¸ªï¼Œè¿™ç§æƒ…å†µä¸‹ï¼Œæˆ‘å°±åªèƒ½è¿›è¡Œç¯å¢ƒéš”ç¦»äº†ã€‚æ‰€ä»¥ï¼Œé¦–å…ˆæƒ³åˆ°çš„å°±æ˜¯åˆ©ç”¨å®¹å™¨äº†ï¼Œä¹Ÿå°±å¼€å§‹ç”¨èµ·äº†Dockerã€‚

> åè®°ï¼šæœç„¶æ‡’æ‰æ˜¯ç¬¬ä¸€ç”Ÿäº§åŠ›ï¼Œåé¢ç›´æ¥åˆ†åˆ«å†™äº†å…¬å…±è„šæœ¬å’Œè‡ªå·±ç§ç”¨çš„shellè„šæœ¬ï¼Œç›´æ¥ä¸€æŠŠæ¢­ğŸ˜…

### ä¸€èµ·æˆé•¿(æ¢¦æƒ³ä¾åœ¨ï¼Œäººç”Ÿæ­£å½“å¹´)

> Docker: ä¸ç¤¾åŒºå…±åŒæˆé•¿

ä½¿ç”¨Dockerçš„è¿‡ç¨‹ä¸­ï¼Œå…¶å®ä¹Ÿå¹¶ä¸æ˜¯æƒ³è±¡çš„é‚£ä¹ˆç¾å¥½ï¼Œä¸è¿‡å¥½åœ¨ï¼ŒDockerç»è¿‡è¿™å‡ å¹´çš„è¿­ä»£ï¼Œå˜å¾—è¶Šæ¥è¶Šä¼˜ç§€ï¼Œè€Œæˆ‘çš„æŠ€æœ¯ä¹Ÿåœ¨ç¨³æ­¥æå‡ã€‚è¿™å‡ å¹´ï¼Œæä¾›å®¹å™¨æœåŠ¡çš„å‚å•†ï¼Œäº•å–·å¼çš„å¢é•¿ï¼Œå½“ç„¶ï¼Œä¹Ÿæœ‰ä¸å°‘è¢«è–…å€’é—­çš„ï¼Œæ›¾ç»çš„ä¸‰å¤§å®¹å™¨æœåŠ¡ï¼Œå¦‚ä»Šåªå‰© `HeroKu` è¿˜åœ¨ç»§ç»­ã€‚è™½ç„¶ `Heroku` æ¯ä¸ªæœˆå…è´¹é¢åº¦åªæœ‰550å°æ—¶ï¼Œä½†æ˜¯å®ƒä¸åŒåœ°åŸŸã€ä¸åŒå®¹å™¨ä¹‹é—´ï¼Œç«Ÿç„¶å¯ä»¥åšè´Ÿè½½å‡è¡¡ï¼Œæ›¾ç»ä¸€åº¦æ˜¯ç§‘å­¦ä¸Šç½‘â€œæœ€ä½³å®è·µâ€ã€‚

æœ€å¼€å§‹ï¼Œåªæ˜¯æƒ³ç€æŠŠä¸åŒæœåŠ¡çš„ç¯å¢ƒéš”ç¦»å¼€ï¼Œæ‰ä½¿ç”¨Dockerã€‚åˆ°åæ¥ï¼Œæ¯æ¬¡æ¥è§¦åˆ°æ–°æŠ€æœ¯ï¼Œæˆ‘éƒ½ä¼šå»çœ‹èƒ½ä¸èƒ½ç”¨ Docker è¿è¡Œã€‚å°±å¥½æ¯”â€œä¸–ç•Œè¿è¡Œåœ¨ SharePoint ä¸Šä¸€æ ·â€ï¼ˆdogeï¼Œæˆ‘ç»å¤§éƒ¨åˆ†çš„æœåŠ¡ï¼Œéƒ½æ˜¯è·‘åœ¨ Docker ä¸Šçš„ï¼ŒåŒ…æ‹¬å¼€å‘ã€æµ‹è¯•å’Œéƒ¨ç½²ç¯å¢ƒã€‚åœ¨ç¡®ä¿å¼€å‘ä¸ç”Ÿäº§ä¹‹é—´ä¸€è‡´æ€§çš„åŒæ—¶ï¼Œæˆ‘å¯ä»¥å®Œå…¨åœ¨æœ¬åœ°è¿›è¡Œç¼–ç å’Œæµ‹è¯•ã€‚

åˆ°æ¯•ä¸šåï¼ŒæƒŠå–œçš„å‘ç°ï¼Œä¸å°‘å…¬å¸é¢è¯•çš„æ—¶å€™ï¼Œç†Ÿæ‚‰ Docker éƒ½æ˜¯ä¸€ä¸ªåŠ åˆ†é¡¹ï¼ˆæ˜æ˜åªæ˜¯å¼€å‘ï¼Œç¡¬æ˜¯è¢«é€¼æˆäº†å…¨å¹²å·¥ç¨‹å¸ˆğŸ¤£

### æˆ‘çš„ä¸€äº›Dockerç¬”è®°

å‡ ä¹æ‰€æœ‰ä¸»æµå¹³å°ï¼Œæˆ‘éƒ½ä½¿ç”¨è¿‡ï¼Œä½†é™äºæˆ‘æœ‰60%çš„æœåŠ¡å™¨æ˜¯ `CentOS 7.x`ï¼Œé‚£å°±å›´ç»•è¿™ä¸ªç³»ç»Ÿæ¥å†™å§ã€‚

#### CentOS 7.x && Docker

##### å®‰è£…Docker

* å¸è½½å¯èƒ½å­˜åœ¨çš„æ—§ç‰ˆæœ¬

```bash
[root@besscroft ~]# sudo yum remove docker \
                  docker-client \
                  docker-client-latest \
                  docker-common \
                  docker-latest \
                  docker-latest-logrotate \
                  docker-logrotate \
                  docker-engine
```

* è®¾ç½®ç¨³å®šçš„å­˜å‚¨åº“å¹¶å®‰è£…

```bash
[root@besscroft ~]# sudo yum install -y yum-utils

[root@besscroft ~]# sudo yum-config-manager \
    --add-repo \
    https://download.docker.com/linux/centos/docker-ce.repo
```

* å®‰è£…æœ€æ–°ç‰ˆæœ¬çš„Docker Engineå’Œå®¹å™¨ï¼Œæˆ–è€…è½¬åˆ°ä¸‹ä¸€æ­¥å®‰è£…ç‰¹å®šç‰ˆæœ¬ï¼š

```bash
[root@besscroft ~]# sudo yum install docker-ce docker-ce-cli containerd.io -y
```

> å¦‚æœæç¤ºæ‚¨æ¥å— GPG å¯†é’¥ï¼Œè¯·éªŒè¯æŒ‡çº¹æ˜¯å¦åŒ¹é… `060A 61C5 1B55 8A7F 742B 77AA C52F EB6B 621E 9F35`ï¼Œå¦‚æœæ˜¯ï¼Œåˆ™æ¥å—å®ƒã€‚

* è®¾ç½®å¼€æœºå¯åŠ¨ï¼Œå¹¶å¯åŠ¨Docker

```bash
[root@besscroft ~]# sudo systemctl enable docker
[root@besscroft ~]# sudo systemctl start docker
```

##### Dockerå®‰è£…é…ç½®Redis

* æ‹‰å–é•œåƒ

```bash
[root@besscroft ~]# docker pull redis:6.0.9
```

- åœ¨åˆé€‚çš„ä½ç½®åˆ›å»ºä¸‹é¢ä¸¤ä¸ªæ–‡ä»¶å¤¹

```bash
[root@besscroft ~]# mkdir conf
[root@besscroft ~]# mkdir data
```

- å¯åŠ¨å®¹å™¨

```bash
[root@besscroft ~]# docker run -d -p 6379:6379 --restart always --name bess-redis \
-v /root/conf/redis.conf:/usr/local/etc/redis/redis.conf \
-v /root/data:/data \
redis:6.0.9 redis-server /usr/local/etc/redis/redis.conf \
--requirepass "password" --appendonly yes
```

> -d åœ¨åå°è¿è¡Œ
>
> -p 6379:6379 ç«¯å£æ˜ å°„ï¼Œå·¦è¾¹ä¸ºå®¿ä¸»æœºçš„ç«¯å£ï¼Œå³è¾¹ä¸ºå®¹å™¨çš„ç«¯å£
>
> --restart always è‡ªåŠ¨å¯åŠ¨
>
> --privileged=true ç»™å®¹å™¨rootæƒé™
>
> -v /root/conf/redis.conf:/usr/local/etc/redis/redis.conf æŒ‚è½½é…ç½®æ–‡ä»¶ï¼Œå†’å·å·¦è¾¹ä¸ºå®¿ä¸»æœºï¼Œå³è¾¹ä¸ºå®¹å™¨
>
> -v /root/data:/data æ•°æ®ç›®å½•ï¼Œå†’å·å·¦è¾¹ä¸ºå®¿ä¸»æœºï¼Œå³è¾¹ä¸ºå®¹å™¨
>
> --requirepass å†’å·é‡Œé¢å¡«å¯†ç ï¼Œä¹Ÿå¯ä»¥åœ¨confé‡Œé¢é…ç½®
>
> --appendonly æ˜¯å¦å¼€å¯æŒä¹…åŒ–ï¼Œä¹Ÿå¯ä»¥åœ¨confé‡Œé¢é…ç½®

##### å¯åŠ¨è‡ªå®šä¹‰çš„å®¹å™¨

- åˆ›å»ºç”¨æˆ·å®šä¹‰çš„ç½‘ç»œ

```bash
[root@besscroft ~]# docker network create somenetwork
```

- è¿è¡Œé•œåƒ

```bash
[root@besscroft ~]# docker run -d --name <å®¹å™¨å> --net somenetwork -p<ä¸»æœºç«¯å£>:<å®¹å™¨ç«¯å£> <é•œåƒå>:<ç‰ˆæœ¬å·> --appendonly yes
```

> åŸºæœ¬ä¸Šå¤§éƒ¨åˆ†å®¹å™¨å¯ä»¥æŒ‰ç…§æ­¤æ€è·¯æ¥ã€‚

##### Windows 10 é…ç½®ç‹—ä¸œè‡ªåŠ¨è„šæœ¬

- ä¸‹è½½é•œåƒ

```bash
[root@besscroft ~]# docker pull registry.cn-hangzhou.aliyuncs.com/supermanito/jd
```

- å¯åŠ¨å®¹å™¨

```bash
[root@besscroft ~]# docker run -dit \
-v D:/data/jd/scripts:/jd/scripts `# è®¾ç½®æ´»åŠ¨è„šæœ¬çš„ä¸»æœºæŒ‚è½½ç›®å½•ä¸ºD:/data/jd/scripts` \
-v D:/data/jd/config:/jd/config `# è®¾ç½®é…ç½®æ–‡ä»¶çš„ä¸»æœºæŒ‚è½½ç›®å½•ä¸ºD:/data/jd/config` \
-v D:/data/jd/log:/jd/log `# è®¾ç½®æ—¥å¿—æ–‡ä»¶çš„ä¸»æœºæŒ‚è½½ç›®å½•ä¸ºD:/data/jd/log` \
-p 5678:5678 `# è®¾ç½®ç«¯å£æ˜ å°„ï¼Œæ ¼å¼ä¸º "ä¸»æœºç«¯å£:å®¹å™¨ç«¯å£"ï¼Œä¸»æœºç«¯å£å·å¯è‡ªå®šä¹‰` \
-e ENABLE_HANGUP=true `# å¯ç”¨æŒ‚æœºåŠŸèƒ½` \
-e ENABLE_WEB_PANEL=true `# å¯ç”¨æ§åˆ¶é¢æ¿åŠŸèƒ½` \
--name jd `# è®¾ç½®å®¹å™¨åä¸º jd ` \
--network bridge `# è®¾ç½®å®¹å™¨ç½‘ç»œç±»å‹ä¸ºæ¡¥æ¥ï¼Œç›´è¿ä¸»æœº` \
--hostname jd `# è®¾ç½®å®¹å™¨å†…ä¸»æœºåä¸º jd ` \
--restart always `# è®¾ç½®å®¹å™¨å¼€æœºè‡ªå¯` \
registry.cn-hangzhou.aliyuncs.com/supermanito/jd
```

### å­¦ä¹ Docker

æ¨è2æœ¬ä¹¦ï¼šã€ŠDockerå®æˆ˜ã€‹ã€ã€Šç¬¬ä¸€æœ¬Dockerä¹¦ã€‹ï¼Œæˆ‘åªçœ‹è¿‡ã€Šç¬¬ä¸€æœ¬Dockerä¹¦ã€‹ï¼Œä¸ªäººæ„Ÿè§‰è¿˜ä¸é”™ã€‚

ç„¶åå°±æ˜¯å®˜æ–¹æ–‡æ¡£äº†ï¼Œå·²ç»å¤Ÿè¯¦ç»†äº†ï¼Œç¢°åˆ°é—®é¢˜ä¹Ÿå¯ä»¥å»ä»“åº“çš„issuesçœ‹çœ‹ã€‚

### ARM Docker

![](/images/articles/2021/Dockerç¬”è®°/docker-desktop-m1.jpg)

2021å¹´4æœˆ15æ—¥ï¼ŒDockerèƒ½å¤Ÿè¿è¡Œåœ¨M1èŠ¯ç‰‡çš„Macbookä¸Šé¢äº†ï¼Œä¹Ÿé¢„ç¤ºç€ ARM æ¶æ„çš„æœªæ¥ã€‚è™½ç„¶ç°åœ¨è¿˜éœ€è¦å®‰è£… Rosetta æ¥è¿›è¡Œå…¼å®¹ï¼Œå½“ä½ æƒ³è¦åœ¨å®˜ç½‘ä¸‹è½½æ—¶ï¼Œå°±ä¼šæé†’ä½ ã€‚Vç«™ä¸Šä¸å°‘äººéƒ½è¯´ï¼ŒM1å¼€å‘å¾ˆé¦™ğŸ˜¯ç°åœ¨ä¼°è®¡å°±æ˜¯å…¼å®¹æ€§é—®é¢˜ï¼Œè®©å¾ˆå¤šäººä¸æ•¢ä¸Šè½¦ã€‚

ä¸è¿‡æˆ‘è¿™é‡Œè¿˜æ˜¯å¿ä¸ä½åæ§½ä¸€ä¸‹ï¼Œè‹¹æœä½ ä¸å‡ºå°é”®ç›˜ï¼Œæˆ‘æ˜¯ç»å¯¹ä¸ä¼šä¹° MacBook çš„ğŸ™„åæ­£ä¸ä¹°ä¹Ÿèƒ½ç…§æ ·ç”¨ MacOSï¼Œè€Œä¸”æ€§èƒ½ä¹Ÿä¸å·®ã€‚
